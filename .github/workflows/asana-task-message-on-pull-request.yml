name: Asana task message on pull request

on: [pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Define variables
        run: |
          echo "0/227574f591313661629478091f094e34" > ASANA_AUTH_TOKEN
          echo "1151485487957120" > TASK_ID
          echo "https://app.asana.com/api/1.0/tasks/$(cat TASK_ID)/stories" > TASK_URL
          echo "Authorization: Bearer $(cat ASANA_AUTH_TOKEN)" > AUTH_HEADER
          echo '{"data":{"task":"$(cat TASK_ID)","text":"[Autogenerated message]\n Pull request link: ${GITHUB_REPOSITORY}/pull/"}}' > MESSAGE_DATA
      - name: Add message
        run: |
          curl -X POST $(cat TASK_URL) \
          -H 'Content-Type: application/json' \
          -H 'Accept: application/json' \
          -H $(cat AUTH_HEADER) \
          -d $(cat MESSAGE_DATA)