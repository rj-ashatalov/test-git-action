name: Asana task message on pull request

on: [pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Add message
        run: |
          task_id=$(${{ github.ref }}|grep -Pio "(?:\d\/)(\d+)")
          echo $task_id
          curl -X POST https://app.asana.com/api/1.0/tasks/$task_id/stories \
          -H 'Content-Type: application/json' \
          -H 'Accept: application/json' \
          -H "Authorization: Bearer $ASANA_AUTH_TOKEN" \
          -d '{"data":{"text":"[Github autogenerated]\nPull request link: ${{ github.event.pull_request.url }}"}}'
        env:
          ASANA_AUTH_TOKEN: "0/227574f591313661629478091f094e34"